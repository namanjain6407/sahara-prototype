<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sahara App - 3D Design Prototype</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background-color: #0f172a; font-family: sans-serif; }
        #canvas-container { width: 100vw; height: 100vh; }
        
        /* UI Overlay Styling */
        #phone-screen-ui {
            position: absolute;
            width: 300px;
            height: 600px;
            background: #000;
            pointer-events: auto;
            border-radius: 36px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            user-select: none;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            visibility: hidden;
        }

        .screen-content {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            background: #fff;
        }

        .big-button {
            border-radius: 50%;
            width: 140px;
            height: 140px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 800;
            color: white;
            text-transform: uppercase;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            transition: transform 0.1s;
            cursor: pointer;
            margin: 0 auto;
        }

        .big-button:active { transform: scale(0.95); }

        #sos-hold-ring {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 180px;
            height: 180px;
            border: 8px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            pointer-events: none;
            display: none;
        }
        
        #sos-hold-progress {
            position: absolute;
            top: -8px; left: -8px;
            width: 180px; height: 180px;
            border: 8px solid #ff0000;
            border-radius: 50%;
            border-top-color: transparent;
            animation: rotate 2s linear;
        }

        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* Calling Screen Animation */
        .pulse { animation: pulse 1.5s infinite; }
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Modal / Call Screen */
        #emergency-screen {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #b91c1c;
            color: white;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            text-align: center;
            padding: 20px;
        }

        .instructions {
            position: fixed;
            bottom: 20px;
            left: 20px;
            color: white;
            background: rgba(0,0,0,0.6);
            padding: 15px;
            border-radius: 10px;
            pointer-events: none;
        }

        /* Medicine List Styling */
        .medicine-card {
            background: white;
            border-radius: 16px;
            padding: 12px;
            border: 2px solid #e2e8f0;
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 10px;
            transition: border-color 0.2s;
        }
        .medicine-card:has(input:checked) {
            border-color: #10b981;
            background: #f0fdf4;
        }
    </style>
</head>
<body>

    <div id="canvas-container"></div>

    <div class="instructions">
        <h3 class="font-bold mb-1">Sahara App: Audio & Med Update</h3>
        <p class="text-sm">‚Ä¢ Tap üîä to hear medicine instructions</p>
        <p class="text-sm">‚Ä¢ Added 2 new real-world medicines</p>
    </div>

    <!-- The Phone Screen Interface -->
    <div id="phone-screen-ui">
        <div class="bg-black text-white text-[10px] px-6 py-1 flex justify-between items-center">
            <span id="screen-time">9:10</span>
            <div class="flex gap-1"><span>üì∂</span><span>üîã 95%</span></div>
        </div>

        <!-- Main Home Screen -->
        <div id="screen-home" class="screen-content items-center justify-around py-10">
            <div onclick="showScreen('health')" class="big-button bg-blue-600">Health</div>
            <div id="sos-btn" class="big-button bg-red-600 text-3xl">SOS</div>
            <div onclick="showScreen('youtube')" class="big-button bg-green-600">YouTube</div>
            
            <div id="sos-hold-ring"><div id="sos-hold-progress"></div></div>
        </div>

        <!-- Health Screen -->
        <div id="screen-health" class="screen-content hidden bg-blue-50">
            <div class="flex items-center gap-4 mb-2">
                <button onclick="showScreen('home')" class="text-3xl p-2">‚¨ÖÔ∏è</button>
                <h1 class="text-2xl font-bold">Medicines</h1>
            </div>
            
            <div class="flex-1 overflow-y-auto pr-1">
                <!-- Med 1 -->
                <div class="medicine-card">
                    <span class="text-3xl">üíä</span>
                    <div class="flex-1">
                        <p class="font-bold text-lg leading-tight">BP Pill</p>
                        <p class="text-sm text-gray-500">1 tablet, Morning</p>
                    </div>
                    <button onclick="speak('Take one Blood Pressure pill now. One tablet, in the morning.')" class="text-3xl p-2 hover:bg-gray-100 rounded-full">üîä</button>
                    <input type="checkbox" class="w-8 h-8 rounded">
                </div>

                <!-- Med 2 -->
                <div class="medicine-card">
                    <span class="text-3xl">üß™</span>
                    <div class="flex-1">
                        <p class="font-bold text-lg leading-tight">Sugar Syrup</p>
                        <p class="text-sm text-gray-500">2 spoons, Lunch</p>
                    </div>
                    <button onclick="speak('Take two spoons of Sugar Syrup. Two spoons, at Lunch time.')" class="text-3xl p-2 hover:bg-gray-100 rounded-full">üîä</button>
                    <input type="checkbox" class="w-8 h-8 rounded">
                </div>

                <!-- Med 3 (New) -->
                <div class="medicine-card">
                    <span class="text-3xl">üëÅÔ∏è</span>
                    <div class="flex-1">
                        <p class="font-bold text-lg leading-tight">Eye Drops</p>
                        <p class="text-sm text-gray-500">2 drops, Night</p>
                    </div>
                    <button onclick="speak('Put two drops in your left eye. Two drops, at Night.')" class="text-3xl p-2 hover:bg-gray-100 rounded-full">üîä</button>
                    <input type="checkbox" class="w-8 h-8 rounded">
                </div>

                <!-- Med 4 (New) -->
                <div class="medicine-card">
                    <span class="text-3xl">ü¶µ</span>
                    <div class="flex-1">
                        <p class="font-bold text-lg leading-tight">Pain Gel</p>
                        <p class="text-sm text-gray-500">Apply on Knees</p>
                    </div>
                    <button onclick="speak('Apply pain relief gel on both knees before sleeping.')" class="text-3xl p-2 hover:bg-gray-100 rounded-full">üîä</button>
                    <input type="checkbox" class="w-8 h-8 rounded">
                </div>
            </div>
            
            <button onclick="triggerEmergency()" class="w-full bg-red-600 text-white font-bold py-4 rounded-2xl text-2xl mt-2">SOS</button>
        </div>

        <!-- YouTube Screen -->
        <div id="screen-youtube" class="screen-content hidden bg-red-50">
            <div class="flex items-center gap-4 mb-4">
                <button onclick="showScreen('home')" class="text-3xl p-2">‚¨ÖÔ∏è</button>
                <h1 class="text-2xl font-bold text-red-600">YouTube</h1>
            </div>
            <div class="flex-1 space-y-4">
                <div class="w-full aspect-video bg-gray-400 rounded-xl flex items-center justify-center text-4xl">‚ñ∂Ô∏è</div>
                <p class="font-bold text-lg">Morning Bhajan</p>
                <div class="w-full aspect-video bg-gray-400 rounded-xl flex items-center justify-center text-4xl">‚ñ∂Ô∏è</div>
                <p class="font-bold text-lg">Daily Exercise</p>
            </div>
            <button onclick="triggerEmergency()" class="w-full bg-red-600 text-white font-bold py-5 rounded-2xl text-2xl mt-4">SOS</button>
        </div>
    </div>

    <!-- Emergency Simulation Overlay -->
    <div id="emergency-screen">
        <div class="mb-10 pulse">
            <div class="w-32 h-32 bg-white rounded-full flex items-center justify-center mx-auto mb-4">
                <span class="text-6xl text-red-600">üìû</span>
            </div>
            <h1 class="text-4xl font-black">CALLING SON...</h1>
            <p class="text-xl opacity-80 mt-2">Speaker Active</p>
        </div>

        <div class="bg-black/20 p-6 rounded-3xl w-full max-w-sm mb-10">
            <h2 class="font-bold text-xl mb-2">üìç LOCATION SENT</h2>
            <p id="location-text" class="text-lg">Fetching your coordinates...</p>
        </div>

        <button onclick="cancelEmergency()" class="bg-white text-red-700 px-12 py-5 rounded-full font-black text-2xl shadow-xl">CANCEL</button>
    </div>

    <script>
        let scene, camera, renderer, phone;
        let sosTimer;
        const phoneWidth = 3.5, phoneHeight = 7, phoneDepth = 0.4;

        // --- App Logic ---
        
        // Text to Speech Function
        function speak(text) {
            if ('speechSynthesis' in window) {
                // Cancel any ongoing speech first
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.rate = 0.8; // Slower for seniors
                utterance.pitch = 1.0;
                window.speechSynthesis.speak(utterance);
            } else {
                console.error("Speech synthesis not supported.");
            }
        }

        function showScreen(screenId) {
            ['home', 'health', 'youtube'].forEach(s => document.getElementById(`screen-${s}`).classList.add('hidden'));
            document.getElementById(`screen-${screenId}`).classList.remove('hidden');
            window.speechSynthesis.cancel(); // Stop talking when switching screens
        }

        function triggerEmergency() {
            document.getElementById('emergency-screen').style.display = 'flex';
            speak("Emergency alert triggered. Calling your son and sharing your location.");
            
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (pos) => {
                        const lat = pos.coords.latitude.toFixed(4);
                        const lon = pos.coords.longitude.toFixed(4);
                        document.getElementById('location-text').innerHTML = `Lat: ${lat}<br>Lon: ${lon}`;
                    },
                    () => { document.getElementById('location-text').innerText = "Location Shared (Manual Override)"; }
                );
            }
        }

        function cancelEmergency() {
            document.getElementById('emergency-screen').style.display = 'none';
            window.speechSynthesis.cancel();
        }

        // SOS Long Press
        const sosBtn = document.getElementById('sos-btn');
        const holdRing = document.getElementById('sos-hold-ring');

        function startSOS() {
            holdRing.style.display = 'block';
            sosTimer = setTimeout(() => {
                triggerEmergency();
                holdRing.style.display = 'none';
            }, 2000);
        }

        function cancelSOS() {
            clearTimeout(sosTimer);
            holdRing.style.display = 'none';
        }

        sosBtn.addEventListener('mousedown', startSOS);
        sosBtn.addEventListener('touchstart', (e) => { e.preventDefault(); startSOS(); });
        window.addEventListener('mouseup', cancelSOS);
        window.addEventListener('touchend', cancelSOS);

        // Update Clock
        setInterval(() => {
            const now = new Date();
            document.getElementById('screen-time').innerText = now.getHours() + ":" + String(now.getMinutes()).padStart(2, '0');
        }, 1000);

        // --- Three.js Logic ---
        function init3D() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0f172a);
            camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 12;

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            document.getElementById('canvas-container').appendChild(renderer.domElement);

            scene.add(new THREE.AmbientLight(0xffffff, 0.7));
            const dl = new THREE.DirectionalLight(0xffffff, 0.5);
            dl.position.set(5, 10, 7.5);
            scene.add(dl);

            const materials = [
                new THREE.MeshStandardMaterial({ color: 0x334155 }), // R
                new THREE.MeshStandardMaterial({ color: 0x334155 }), // L
                new THREE.MeshStandardMaterial({ color: 0x334155 }), // T
                new THREE.MeshStandardMaterial({ color: 0x334155 }), // B
                new THREE.MeshStandardMaterial({ color: 0x000000 }), // Front
                new THREE.MeshStandardMaterial({ color: 0x1e293b })  // Back
            ];
            phone = new THREE.Mesh(new THREE.BoxGeometry(phoneWidth, phoneHeight, phoneDepth), materials);
            scene.add(phone);

            // Drag Controls
            let isDragging = false, prevM = { x: 0, y: 0 };
            const onMove = (x, y) => {
                if(isDragging) {
                    phone.rotation.y += (x - prevM.x) * 0.01;
                    phone.rotation.x += (y - prevM.y) * 0.01;
                }
                prevM = { x, y };
            };
            window.addEventListener('mousedown', () => isDragging = true);
            window.addEventListener('mouseup', () => isDragging = false);
            window.addEventListener('mousemove', (e) => onMove(e.offsetX, e.offsetY));
            window.addEventListener('touchstart', (e) => { isDragging = true; prevM = { x: e.touches[0].clientX, y: e.touches[0].clientY }; });
            window.addEventListener('touchmove', (e) => onMove(e.touches[0].clientX, e.touches[0].clientY));
            window.addEventListener('touchend', () => isDragging = false);

            animate();
        }

        function animate() {
            requestAnimationFrame(animate);
            const ui = document.getElementById('phone-screen-ui');
            const v = new THREE.Vector3(0, 0, phoneDepth/2 + 0.01);
            phone.localToWorld(v);
            v.project(camera);
            
            const x = (v.x * 0.5 + 0.5) * window.innerWidth;
            const y = (-(v.y * 0.5) + 0.5) * window.innerHeight;

            const normal = new THREE.Vector3(0, 0, 1).applyQuaternion(phone.quaternion);
            const view = new THREE.Vector3().subVectors(camera.position, phone.position).normalize();
            
            if (normal.dot(view) > 0) {
                ui.style.visibility = 'visible';
                ui.style.left = `${x}px`;
                ui.style.top = `${y}px`;
                const dist = camera.position.distanceTo(phone.position);
                ui.style.transform = `translate(-50%, -50%) rotateY(${phone.rotation.y}rad) rotateX(${phone.rotation.x}rad) scale(${12 / dist})`;
            } else {
                ui.style.visibility = 'hidden';
            }
            renderer.render(scene, camera);
        }

        window.onload = init3D;
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>